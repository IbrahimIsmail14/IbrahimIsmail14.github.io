<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta name="google-adsense-account" content="ca-pub-3006614855562533">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6MV5MKYY1H"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-6MV5MKYY1H');
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Complete Quran Explorer - Read, listen, and understand the Holy Quran with translations, tafsir, recitations, daily prayers, Islamic knowledge, and accurate prayer times.">
    <meta name="keywords" content="Quran, Islam, Muslim, Arabic, translation, tafsir, recitation, prayer times, salah, dua, Islamic knowledge">
    <title>Quran Explorer - Complete Islamic Resource: Quran, Tafsir, Prayers & Knowledge</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3006614855562533" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic&family=Amiri&family=Scheherazade&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0d9488;
            --primary-light: #14b8a6;
            --primary-dark: #0f766e;
            --secondary: #0891b2;
            --light: #f8fafc;
            --dark: #0f172a;
            --text-light: #64748b;
            --text-dark: #1e293b;
            --card-light: #ffffff;
            --card-dark: #1e293b;
            --transition: all 0.3s ease;
            --gold: #d4af37;
            --light-gold: #f0e6c2;
            --accent: #8b5cf6;
            --play-btn: #10b981;
            --pause-btn: #f59e0b;
            --success: #059669;
            --warning: #d97706;
            --error: #dc2626;
            --info: #0ea5e9;
            --fajr: #6366f1;
            --sunrise: #f59e0b;
            --dhuhr: #10b981;
            --asr: #0ea5e9;
            --maghrib: #d97706;
            --isha: #7c3aed;
            --gradient-primary: linear-gradient(135deg, #0d9488 0%, #0891b2 100%);
            --gradient-gold: linear-gradient(135deg, #d4af37 0%, #f0e6c2 100%);
            --gradient-accent: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f0fdfa 100%);
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            transition: var(--transition);
            min-height: 100vh;
            background-attachment: fixed;
            background-size: cover;
            line-height: 1.6;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 10% 20%, rgba(13, 148, 136, 0.05) 0%, rgba(8, 145, 178, 0.05) 90%);
            z-index: -1;
        }

        .dark {
            background: linear-gradient(135deg, #0c4a6e 0%, #164e63 100%);
            color: #e2e8f0;
        }

        .dark::before {
            background: radial-gradient(circle at 10% 20%, rgba(13, 148, 136, 0.1) 0%, rgba(8, 145, 178, 0.1) 90%);
        }

        /* Header & Navigation */
        .sticky-top {
            position: sticky;
            top: 0;
            z-index: 100;
            background: inherit;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        header {
            background: var(--gradient-primary);
            color: white;
            padding: 1.5rem 1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid var(--gold);
        }

        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="10" y="50" font-family="Noto Naskh Arabic" font-size="28" fill="rgba(255,255,255,0.1)" transform="rotate(-30)">﷽</text></svg>');
            opacity: 0.3;
        }

        .header-content {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        h1 i {
            color: var(--gold);
            text-shadow: 0 0 8px rgba(212, 175, 55, 0.6);
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 0.5rem;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            font-weight: 500;
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Main Navigation */
        .main-nav {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            max-width: 1200px;
            margin: 0 auto;
        }

        .dark .main-nav {
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .nav-btn {
            padding: 0.8rem 1.5rem;
            background: var(--gradient-primary);
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 12px;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .nav-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1), 0 3px 6px rgba(0,0,0,0.1);
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 2rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            text-align: center;
            margin-bottom: 2.5rem;
            background: var(--gradient-primary);
            color: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 12px 30px rgba(13, 148, 136, 0.3);
            position: relative;
            overflow: hidden;
        }

        .section-header h2 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .section-header p {
            position: relative;
            z-index: 2;
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Quran Section */
        .surah-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .surah-card {
            background: var(--card-light);
            border-radius: 18px;
            padding: 1.8rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
            cursor: pointer;
        }

        .dark .surah-card {
            background: var(--card-dark);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .surah-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .surah-card::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0.8;
        }

        .surah-number {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--gradient-gold);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            z-index: 2;
            border: 2px solid white;
        }

        .surah-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-dark);
        }

        .dark .surah-name {
            color: var(--primary-light);
        }

        .surah-name-arabic {
            font-family: 'Noto Naskh Arabic', serif;
            font-size: 2rem;
            margin: 1rem 0;
            direction: rtl;
            color: var(--text-dark);
        }

        .dark .surah-name-arabic {
            color: #e2e8f0;
        }

        .surah-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* Ayah Display */
        .ayah-card {
            background: var(--card-light);
            border-radius: 18px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .dark .ayah-card {
            background: var(--card-dark);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .ayah-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .ayah-card::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0.8;
        }

        .ayah-number {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            background: var(--gradient-gold);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            z-index: 2;
            border: 2px solid white;
        }

        .ayah {
            font-family: 'Noto Naskh Arabic', serif;
            font-size: 2rem;
            margin: 2rem 0 0 0;
            direction: rtl;
            text-align: right;
            line-height: 1.8;
            color: var(--text-dark);
            letter-spacing: 1px;
            position: relative;
            padding: 0 2rem;
        }

        .ayah::before {
            content: "﴾";
            position: absolute;
            top: -0.5rem;
            right: 0;
            font-size: 2.5rem;
            color: var(--gold);
            opacity: 0.6;
        }

        .ayah::after {
            content: "﴿";
            position: absolute;
            bottom: -1.5rem;
            left: 0;
            font-size: 2.5rem;
            color: var(--gold);
            opacity: 0.6;
        }

        .dark .ayah {
            color: #e2e8f0;
        }

        .translation {
            font-size: 1.2rem;
            margin: 2rem 0;
            line-height: 1.7;
            color: var(--text-dark);
            padding: 0 2rem;
            font-style: italic;
        }

        .dark .translation {
            color: #e2e8f0;
        }

        /* Audio Player */
        .audio-player-container {
            margin: 1.5rem 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            background: var(--card-light);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .dark .audio-player-container {
            background: var(--card-dark);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .player-controls {
            display: flex;
            align-items: center;
            padding: 1rem;
            gap: 1rem;
            background: #f8fafc;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .dark .player-controls {
            background: #1e293b;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .player-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .player-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .player-btn.pause {
            background: var(--pause-btn);
        }

        .player-btn.pause:hover {
            background: #e4840a;
        }

        .player-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }

        .player-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .player-surah {
            font-weight: 600;
            color: var(--primary-dark);
        }

        .dark .player-surah {
            color: var(--primary-light);
        }

        .player-ayah {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .progress-container {
            flex: 2;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            cursor: pointer;
        }

        .dark .progress-bar {
            background: #334155;
        }

        .progress {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .time-display {
            font-size: 0.9rem;
            color: var(--text-light);
            min-width: 100px;
            text-align: center;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        .dark .volume-slider {
            background: #334155;
        }

        audio {
            width: 100%;
            margin: 0;
            border-radius: 0;
            box-shadow: none;
            border: none;
        }

        audio::-webkit-media-controls-panel {
            background: var(--card-light);
            border-radius: 0;
        }

        .dark audio::-webkit-media-controls-panel {
            background: #1e293b;
        }

        /* Tafsir Section */
        .tafsir-container {
            margin-top: 1.5rem;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            background: #f8fafc;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .dark .tafsir-container {
            background: #1e293b;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .tafsir-header {
            background: var(--gradient-primary);
            color: white;
            padding: 1rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }
        
        .tafsir-header:hover {
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
        }
        
        .tafsir-content {
            background: #f1f5f9;
            padding: 1.5rem;
            line-height: 1.7;
            color: var(--text-light);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        
        .dark .tafsir-content {
            background: #1e293b;
            color: #94a3b8;
        }
        
        .tafsir-content.expanded {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .tafsir-toggle {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
        }
        
        .tafsir-toggle.expanded {
            transform: rotate(180deg);
        }

        /* Prayer Times Section */
        .prayer-times-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .prayer-card {
            background: var(--card-light);
            border-radius: 18px;
            padding: 2rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
            text-align: center;
        }

        .dark .prayer-card {
            background: var(--card-dark);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .prayer-card.current {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .prayer-card::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            opacity: 0.8;
        }

        .prayer-card.fajr::after { background: var(--fajr); }
        .prayer-card.sunrise::after { background: var(--sunrise); }
        .prayer-card.dhuhr::after { background: var(--dhuhr); }
        .prayer-card.asr::after { background: var(--asr); }
        .prayer-card.maghrib::after { background: var(--maghrib); }
        .prayer-card.isha::after { background: var(--isha); }

        .prayer-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .prayer-card.fajr .prayer-icon { color: var(--fajr); }
        .prayer-card.sunrise .prayer-icon { color: var(--sunrise); }
        .prayer-card.dhuhr .prayer-icon { color: var(--dhuhr); }
        .prayer-card.asr .prayer-icon { color: var(--asr); }
        .prayer-card.maghrib .prayer-icon { color: var(--maghrib); }
        .prayer-card.isha .prayer-icon { color: var(--isha); }

        .prayer-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .prayer-time {
            font-size: 2rem;
            font-weight: 700;
            margin: 1rem 0;
        }

        .prayer-next {
            background: rgba(13, 148, 136, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            color: var(--primary);
            display: inline-block;
        }

        .dark .prayer-next {
            background: rgba(13, 148, 136, 0.15);
            color: var(--primary-light);
        }

        .countdown {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-top: 0.5rem;
        }

        .dark .countdown {
            color: var(--primary-light);
        }

        .location-info {
            background: var(--card-light);
            border-radius: 18px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .dark .location-info {
            background: var(--card-dark);
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* Dua Section */
        .duas-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .dua-category {
            margin-top: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
            color: var(--primary-dark);
            font-size: 1.5rem;
            font-weight: 600;
            grid-column: 1 / -1;
        }
        
        .dark .dua-category {
            color: var(--primary-light);
            border-bottom-color: var(--primary-light);
        }
        
        .dua-card {
            background: var(--card-light);
            border-radius: 18px;
            padding: 1.8rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .dark .dua-card {
            background: var(--card-dark);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .dua-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .dua-card::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-gold);
            opacity: 0.8;
        }
        
        .dua-title {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--primary-dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .dark .dua-title {
            color: var(--primary-light);
        }
        
        .dua-title i {
            color: var(--gold);
        }
        
        .dua-arabic {
            font-family: 'Noto Naskh Arabic', serif;
            font-size: 1.8rem;
            margin: 1rem 0;
            direction: rtl;
            text-align: right;
            line-height: 1.8;
            color: var(--text-dark);
            letter-spacing: 1px;
            position: relative;
            padding: 0 1rem;
        }
        
        .dark .dua-arabic {
            color: #e2e8f0;
        }
        
        .dua-translation {
            font-size: 1.1rem;
            margin: 1.5rem 0;
            line-height: 1.6;
            color: var(--text-dark);
            padding: 0 1rem;
            font-style: italic;
        }
        
        .dark .dua-translation {
            color: #e2e8f0;
        }
        
        .dua-reference {
            margin-top: 1.5rem;
            padding: 0.8rem;
            background: rgba(13, 148, 136, 0.1);
            border-radius: 10px;
            font-size: 0.9rem;
            color: var(--primary-dark);
            border-left: 3px solid var(--primary);
        }
        
        .dark .dua-reference {
            background: rgba(13, 148, 136, 0.15);
            color: var(--primary-light);
            border-left-color: var(--primary-light);
        }

        /* Hadith Section */
        .hadiths-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .hadith-category {
            margin-top: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
            color: var(--primary-dark);
            font-size: 1.5rem;
            font-weight: 600;
            grid-column: 1 / -1;
        }
        
        .dark .hadith-category {
            color: var(--primary-light);
            border-bottom-color: var(--primary-light);
        }
        
        .hadith-card {
            background: var(--card-light);
            border-radius: 18px;
            padding: 1.8rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .dark .hadith-card {
            background: var(--card-dark);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .hadith-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .hadith-card::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-accent);
            opacity: 0.8;
        }
        
        .hadith-title {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--primary-dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .dark .hadith-title {
            color: var(--primary-light);
        }
        
        .hadith-title i {
            color: var(--accent);
        }
        
        .hadith-arabic {
            font-family: 'Noto Naskh Arabic', serif;
            font-size: 1.5rem;
            margin: 1rem 0;
            direction: rtl;
            text-align: right;
            line-height: 1.8;
            color: var(--text-dark);
            letter-spacing: 1px;
            position: relative;
            padding: 0 1rem;
        }
        
        .dark .hadith-arabic {
            color: #e2e8f0;
        }
        
        .hadith-translation {
            font-size: 1.1rem;
            margin: 1.5rem 0;
            line-height: 1.6;
            color: var(--text-dark);
            padding: 0 1rem;
            font-style: italic;
        }
        
        .dark .hadith-translation {
            color: #e2e8f0;
        }
        
        .hadith-reference {
            margin-top: 1.5rem;
            padding: 0.8rem;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 10px;
            font-size: 0.9rem;
            color: var(--accent);
            border-left: 3px solid var(--accent);
        }
        
        .dark .hadith-reference {
            background: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
            border-left-color: #a78bfa;
        }

        /* Knowledge Section */
        .knowledge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .knowledge-card {
            background: var(--card-light);
            border-radius: 18px;
            padding: 2rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .dark .knowledge-card {
            background: var(--card-dark);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .knowledge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .knowledge-card::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0.8;
        }

        .knowledge-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
            text-align: center;
        }

        .knowledge-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-dark);
            text-align: center;
        }

        .dark .knowledge-title {
            color: var(--primary-light);
        }

        .knowledge-content {
            line-height: 1.7;
            color: var(--text-dark);
        }

        .dark .knowledge-content {
            color: #e2e8f0;
        }

        .knowledge-list {
            list-style: none;
            padding: 0;
        }

        .knowledge-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark .knowledge-list li {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .knowledge-list li:last-child {
            border-bottom: none;
        }

        .knowledge-list i {
            color: var(--primary);
        }

        /* Search & Filters */
        .search-container {
            display: flex;
            justify-content: center;
            margin: 2rem auto;
            max-width: 600px;
            gap: 1rem;
        }
        
        .search-input {
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            border: 1px solid #cbd5e1;
            background: var(--card-light);
            color: var(--text-dark);
            font-size: 1rem;
            width: 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
        }
        
        .dark .search-input {
            background: var(--card-dark);
            border-color: #334155;
            color: #e2e8f0;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.3);
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background: var(--card-light);
            box-shadow: -5px 0 20px rgba(0,0,0,0.1);
            padding: 2rem;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 1000;
        }

        .dark .settings-panel {
            background: var(--card-dark);
        }

        .settings-panel.open {
            right: 0;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .dark .settings-header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .settings-option {
            margin-bottom: 1.5rem;
        }

        .settings-option label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .settings-option select, .settings-option input {
            width: 100%;
            padding: 0.8rem;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            background: var(--card-light);
            color: var(--text-dark);
            font-family: 'Poppins', sans-serif;
        }

        .dark .settings-option select, .dark .settings-option input {
            background: var(--card-dark);
            border-color: #334155;
            color: #e2e8f0;
        }

        /* Utility Classes */
        .loading::after {
            content: ' ⏳';
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-spinner {
            display: inline-block;
            width: 1.2rem;
            height: 1.2rem;
            border: 3px solid rgba(13, 148, 136, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        .floating-icon {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 1000;
            transition: var(--transition);
        }

        .floating-icon:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .footer {
            text-align: center;
            padding: 2rem 1.5rem;
            color: var(--text-light);
            font-size: 0.95rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            max-width: 1200px;
            margin: 2rem auto 0;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
        }

        .dark .footer {
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            color: #94a3b8;
            background: rgba(15, 23, 42, 0.9);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-light);
            color: var(--text-dark);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            z-index: 1000;
            transition: var(--transition);
            opacity: 0;
            visibility: hidden;
        }

        .dark .toast {
            background: var(--card-dark);
            color: #e2e8f0;
        }

        .toast.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-10px);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        /* New Features */
        .feature-highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .feature-card {
            background: var(--card-light);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: var(--transition);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .dark .feature-card {
            background: var(--card-dark);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .feature-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-dark);
        }

        .dark .feature-title {
            color: var(--primary-light);
        }

        .feature-desc {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: var(--card-light);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .dark .stat-card {
            background: var(--card-dark);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-light);
        }

        /* NEW FEATURES STYLES */
        
        /* User Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .dashboard-card {
            background: var(--card-light);
            border-radius: 18px;
            padding: 1.8rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .dark .dashboard-card {
            background: var(--card-dark);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .dashboard-card::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0.8;
        }
        
        .dashboard-title {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--primary-dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .dark .dashboard-title {
            color: var(--primary-light);
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            stroke: var(--primary);
        }
        
        /* Word by Word */
        .word-highlight {
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 4px;
            padding: 0 2px;
        }
        
        .word-highlight:hover {
            background-color: rgba(13, 148, 136, 0.1);
        }
        
        .word-tooltip {
            position: absolute;
            background: var(--card-light);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            padding: 0.8rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 100;
            max-width: 300px;
            font-size: 0.9rem;
            display: none;
        }
        
        .dark .word-tooltip {
            background: var(--card-dark);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Qibla Finder */
        .qibla-container {
            text-align: center;
            padding: 2rem;
        }
        
        .compass {
            width: 200px;
            height: 200px;
            margin: 0 auto 2rem;
            position: relative;
        }
        
        .compass-face {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #f87171, #fb923c, #fbbf24, #a3e635, #4ade80, #22d3ee, #818cf8, #c084fc, #f87171);
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .compass-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 90px;
            background: #dc2626;
            border-radius: 2px;
            transition: transform 0.5s ease;
        }
        
        .compass-needle::after {
            content: "";
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 15px solid #dc2626;
        }
        
        .qibla-direction {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1rem;
            color: var(--primary);
        }
        
        /* Islamic Calendar */
        .calendar-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }
        
        .calendar-day {
            text-align: center;
            padding: 0.8rem 0.5rem;
            border-radius: 8px;
            background: var(--card-light);
            font-weight: 500;
        }
        
        .dark .calendar-day {
            background: var(--card-dark);
        }
        
        .calendar-date {
            text-align: center;
            padding: 0.8rem 0.5rem;
            border-radius: 8px;
            background: var(--card-light);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .dark .calendar-date {
            background: var(--card-dark);
        }
        
        .calendar-date:hover {
            background: rgba(13, 148, 136, 0.1);
        }
        
        .calendar-date.today {
            background: var(--primary);
            color: white;
        }
        
        .calendar-date.hijri-date {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.3rem;
        }
        
        /* Memorization Mode */
        .memorization-container {
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .memorization-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .memorization-text {
            font-size: 2rem;
            margin: 2rem 0;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--card-light);
            border-radius: 18px;
            padding: 2rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        }
        
        .dark .memorization-text {
            background: var(--card-dark);
        }
        
        .memorization-text.hidden {
            color: transparent;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        /* Kids Mode */
        .kids-mode .header-content h1 {
            font-size: 2.2rem;
        }
        
        .kids-mode .surah-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        .kids-mode .feature-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        .kids-mode .knowledge-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        .dark .kids-mode .surah-card,
        .dark .kids-mode .feature-card,
        .dark .kids-mode .knowledge-card {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .main-nav {
                gap: 0.5rem;
                padding: 0.8rem;
            }
            
            .nav-btn {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
            
            .section-header h2 {
                font-size: 2rem;
            }
            
            .surah-grid, .duas-container, .hadiths-container, .knowledge-grid, .prayer-times-container {
                grid-template-columns: 1fr;
            }
            
            .ayah {
                font-size: 1.8rem;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .player-controls {
                flex-wrap: wrap;
            }
            
            .progress-container {
                order: 3;
                flex: 1 0 100%;
                margin-top: 0.5rem;
            }
            
            .floating-icon {
                bottom: 1.5rem;
                right: 1.5rem;
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .settings-panel {
                width: 100%;
                right: -100%;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .memorization-controls {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .control-btn span {
                display: none;
            }
            
            .control-btn {
                padding: 0.6rem;
            }
            
            .ayah {
                font-size: 1.6rem;
                padding: 0 1rem;
            }
            
            .translation {
                font-size: 1.1rem;
                padding: 0 1rem;
            }
            
            .surah-card, .ayah-card, .dua-card, .hadith-card, .knowledge-card, .prayer-card {
                padding: 1.5rem 1.2rem;
            }
            
            .ayah-number, .surah-number {
                top: 1rem;
                left: 1rem;
                width: 36px;
                height: 36px;
            }
            
            .dua-arabic, .hadith-arabic {
                font-size: 1.6rem;
            }
            
            .prayer-time {
                font-size: 1.5rem;
            }
            
            .compass {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="sticky-top">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-book-quran"></i> Quran Explorer</h1>
                <p class="tagline">Your Complete Islamic Resource</p>
                <div class="header-controls">
                    <button class="control-btn" onclick="toggleNightMode()">
                        <i class="fas fa-moon"></i> <span>Night Mode</span>
                    </button>
                    <button class="control-btn" onclick="scrollToTop()">
                        <i class="fas fa-arrow-up"></i> <span>Top</span>
                    </button>
                    <button class="control-btn" onclick="toggleSettings()">
                        <i class="fas fa-cog"></i> <span>Settings</span>
                    </button>
                    <button class="control-btn" id="kidsModeToggle" onclick="toggleKidsMode()">
                        <i class="fas fa-child"></i> <span>Kids Mode</span>
                    </button>
                    <button class="control-btn" id="userLoginBtn" onclick="toggleUserPanel()">
                        <i class="fas fa-user"></i> <span>Account</span>
                    </button>
                </div>
            </div>
        </header>

        <nav class="main-nav">
            <button class="nav-btn active" onclick="showSection('quran')">
                <i class="fas fa-book-quran"></i> Quran
            </button>
            <button class="nav-btn" onclick="showSection('prayer-times')">
                <i class="fas fa-clock"></i> Prayer Times
            </button>
            <button class="nav-btn" onclick="showSection('qibla')">
                <i class="fas fa-compass"></i> Qibla Finder
            </button>
            <button class="nav-btn" onclick="showSection('islamic-calendar')">
                <i class="fas fa-calendar"></i> Islamic Calendar
            </button>
            <button class="nav-btn" onclick="showSection('duas')">
                <i class="fas fa-hands-praying"></i> Daily Duas
            </button>
            <button class="nav-btn" onclick="showSection('hadiths')">
                <i class="fas fa-book-open"></i> Hadiths
            </button>
            <button class="nav-btn" onclick="showSection('knowledge')">
                <i class="fas fa-graduation-cap"></i> Islamic Knowledge
            </button>
            <button class="nav-btn" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </button>
            <button class="nav-btn" onclick="showSection('about')">
                <i class="fas fa-info-circle"></i> About
            </button>
        </nav>
    </div>

    <!-- User Panel -->
    <div class="settings-panel" id="userPanel">
        <div class="settings-header">
            <h3>User Account</h3>
            <button class="control-btn" onclick="toggleUserPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div id="userLoginForm">
            <div class="settings-option">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Enter your username">
            </div>
            
            <div class="settings-option">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password">
            </div>
            
            <button class="control-btn" style="width: 100%; margin-top: 1rem;" onclick="loginUser()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
            
            <p style="text-align: center; margin-top: 1rem; color: var(--text-light);">
                Don't have an account? <a href="#" onclick="showRegisterForm()" style="color: var(--primary);">Register</a>
            </p>
        </div>
        
        <div id="userRegisterForm" style="display: none;">
            <div class="settings-option">
                <label for="regUsername">Username</label>
                <input type="text" id="regUsername" placeholder="Choose a username">
            </div>
            
            <div class="settings-option">
                <label for="regEmail">Email</label>
                <input type="email" id="regEmail" placeholder="Enter your email">
            </div>
            
            <div class="settings-option">
                <label for="regPassword">Password</label>
                <input type="password" id="regPassword" placeholder="Create a password">
            </div>
            
            <button class="control-btn" style="width: 100%; margin-top: 1rem;" onclick="registerUser()">
                <i class="fas fa-user-plus"></i> Register
            </button>
            
            <p style="text-align: center; margin-top: 1rem; color: var(--text-light);">
                Already have an account? <a href="#" onclick="showLoginForm()" style="color: var(--primary);">Login</a>
            </p>
        </div>
        
        <div id="userProfile" style="display: none;">
            <div style="text-align: center; margin-bottom: 2rem;">
                <div style="width: 80px; height: 80px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: white; font-size: 2rem;">
                    <i class="fas fa-user"></i>
                </div>
                <h3 id="profileUsername">User</h3>
                <p style="color: var(--text-light);" id="profileEmail">user@example.com</p>
            </div>
            
            <div class="settings-option">
                <h4>Reading Progress</h4>
                <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.5rem;">
                    <div style="flex: 1; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                        <div id="readingProgressBar" style="height: 100%; background: var(--primary); width: 25%;"></div>
                    </div>
                    <span id="readingProgressText">25%</span>
                </div>
            </div>
            
            <div class="settings-option">
                <h4>Current Streak</h4>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                    <i class="fas fa-fire" style="color: #f59e0b;"></i>
                    <span id="streakCount">7 days</span>
                </div>
            </div>
            
            <button class="control-btn" style="width: 100%; margin-top: 1rem;" onclick="logoutUser()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>

    <!-- Quran Section -->
    <section id="quran" class="content-section active">
        <div class="section-header">
            <h2>The Holy Quran</h2>
            <p>Read, listen and understand the words of Allah</p>
        </div>

        <!-- Global Audio Player -->
        <div class="audio-player-container" id="globalPlayer" style="display: none;">
            <div class="player-controls">
                <button class="player-btn" id="prevBtn" onclick="playPreviousAyah()">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="player-btn" id="playPauseBtn" onclick="togglePlayPause()">
                    <i class="fas fa-play"></i>
                </button>
                <button class="player-btn" id="nextBtn" onclick="playNextAyah()">
                    <i class="fas fa-step-forward"></i>
                </button>
                
                <div class="player-info">
                    <div class="player-surah" id="playerSurahName">Surah Name</div>
                    <div class="player-ayah" id="playerAyahInfo">Ayah 1 of 7</div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar">
                        <div class="progress" id="progress"></div>
                    </div>
                    <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
                </div>
                
                <div class="volume-control">
                    <i class="fas fa-volume-up"></i>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="100">
                </div>
                
                <div class="player-controls" style="background: transparent; border: none; padding: 0; gap: 0.5rem;">
                    <button class="control-btn" onclick="toggleRepeatMode()" id="repeatBtn" style="padding: 0.5rem;">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="control-btn" onclick="togglePlaybackSpeed()" id="speedBtn" style="padding: 0.5rem;">
                        1x
                    </button>
                </div>
            </div>
            <audio id="globalAudio" preload="metadata"></audio>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" id="surahSearch" placeholder="Search surahs by name...">
            <select class="search-input" id="reciterSelector" style="max-width: 250px;">
                <option value="ar.alafasy">Mishary Alafasy</option>
                <option value="ar.hudhaify">Imam Hudhaify</option>
                <option value="ar.sudais">Abdurrahman As-Sudais</option>
                <option value="ar.abdulsamad">Abdul Samad</option>
                <option value="ar.mahermuaiqly">Maher Al Muaiqly</option>
            </select>
            <select class="search-input" id="translationSelector" style="max-width: 250px;">
                <option value="en.asad">Muhammad Asad</option>
                <option value="en.yusufali">Yusuf Ali</option>
                <option value="en.pickthall">Pickthall</option>
                <option value="en.sahih">Sahih International</option>
            </select>
        </div>

        <div class="surah-grid" id="surahGrid">
            <!-- Surah cards will be loaded here -->
        </div>

        <div id="surahDetail" style="display: none;">
            <!-- Detailed surah view will be loaded here -->
        </div>
        
        <div id="memorizationMode" style="display: none;">
            <div class="section-header">
                <h2>Memorization Mode</h2>
                <p>Practice and test your memorization of the Quran</p>
            </div>
            
            <div class="memorization-container">
                <div class="memorization-controls">
                    <button class="control-btn" onclick="startMemorization()">
                        <i class="fas fa-play"></i> Start
                    </button>
                    <button class="control-btn" onclick="toggleTextVisibility()">
                        <i class="fas fa-eye"></i> Show/Hide
                    </button>
                    <button class="control-btn" onclick="previousAyahMemorization()">
                        <i class="fas fa-step-backward"></i> Previous
                    </button>
                    <button class="control-btn" onclick="nextAyahMemorization()">
                        <i class="fas fa-step-forward"></i> Next
                    </button>
                    <button class="control-btn" onclick="exitMemorizationMode()">
                        <i class="fas fa-times"></i> Exit
                    </button>
                </div>
                
                <div class="memorization-text" id="memorizationText">
                    Select a verse to start memorization
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress" id="memorizationProgress" style="width: 0%;"></div>
                    </div>
                    <div class="time-display" id="memorizationProgressText">0/0</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Prayer Times Section -->
    <section id="prayer-times" class="content-section">
        <div class="section-header">
            <h2>Prayer Times</h2>
            <p>Accurate prayer times based on your location</p>
        </div>

        <div class="location-info" id="locationInfo">
            <div class="loading">Detecting your location... <span class="loading-spinner"></span></div>
        </div>

        <div class="prayer-times-container" id="prayerTimesContainer">
            <!-- Prayer times will be loaded here -->
        </div>

        <div class="knowledge-card" style="max-width: 800px; margin: 2rem auto;">
            <h3 class="knowledge-title">Prayer Times Information</h3>
            <div class="knowledge-content">
                <p>Prayer times are calculated based on your geographical location using the <strong>Islamic Society of North America (ISNA)</strong> calculation method. Times are automatically adjusted for your timezone and daylight saving time.</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div>
                        <strong>Calculation Method:</strong> ISNA
                    </div>
                    <div>
                        <strong>Juristic Method:</strong> Standard (Shafi, Maliki, Hanbali)
                    </div>
                    <div>
                        <strong>Adjustments:</strong> Auto timezone
                    </div>
                </div>
                
                <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-light);">
                    <i class="fas fa-info-circle"></i> For the most accurate prayer times, especially for Fajr and Isha, please consult your local mosque.
                </p>
            </div>
        </div>
    </section>

    <!-- Qibla Finder Section -->
    <section id="qibla" class="content-section">
        <div class="section-header">
            <h2>Qibla Finder</h2>
            <p>Find the direction to the Kaaba in Mecca</p>
        </div>

        <div class="qibla-container">
            <div class="compass">
                <div class="compass-face">
                    <div class="compass-needle" id="compassNeedle"></div>
                </div>
            </div>
            <div class="qibla-direction" id="qiblaDirection">
                Calculating...
            </div>
            <p style="margin-top: 1rem; color: var(--text-light);">
                Point your device towards the Kaaba. Make sure location services are enabled.
            </p>
            
            <button class="control-btn" onclick="startCompass()" style="margin-top: 2rem;">
                <i class="fas fa-sync-alt"></i> Start Compass
            </button>
        </div>
    </section>

    <!-- Islamic Calendar Section -->
    <section id="islamic-calendar" class="content-section">
        <div class="section-header">
            <h2>Islamic Calendar</h2>
            <p>Hijri dates and important Islamic events</p>
        </div>

        <div class="calendar-container">
            <div class="calendar-header">
                <button class="control-btn" onclick="changeCalendarMonth(-1)">
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <h3 id="calendarMonthYear">Month Year</h3>
                <button class="control-btn" onclick="changeCalendarMonth(1)">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <div class="calendar-grid" id="calendarGrid">
                <!-- Calendar will be generated here -->
            </div>
            
            <div class="knowledge-card" style="margin-top: 2rem;">
                <h3 class="knowledge-title">Important Dates</h3>
                <div class="knowledge-content" id="importantDates">
                    <!-- Important dates will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Duas Section -->
    <section id="duas" class="content-section">
        <div class="section-header">
            <h2>Daily Duas & Supplications</h2>
            <p>Authentic prayers from Quran and Sunnah for every occasion</p>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" id="duaSearch" placeholder="Search duas...">
        </div>

        <div class="duas-container" id="duasContainer">
            <!-- Duas will be loaded here -->
        </div>
    </section>

    <!-- Hadiths Section -->
    <section id="hadiths" class="content-section">
        <div class="section-header">
            <h2>Hadith Collection</h2>
            <p>Authentic sayings and teachings of Prophet Muhammad (PBUH)</p>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" id="hadithSearch" placeholder="Search hadiths...">
        </div>

        <div class="hadiths-container" id="hadithsContainer">
            <!-- Hadiths will be loaded here -->
        </div>
    </section>

    <!-- Islamic Knowledge Section -->
    <section id="knowledge" class="content-section">
        <div class="section-header">
            <h2>Islamic Knowledge</h2>
            <p>Learn about Islam, pillars, history and teachings</p>
        </div>

        <div class="feature-highlights">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-mosque"></i>
                </div>
                <h3 class="feature-title">Five Pillars</h3>
                <p class="feature-desc">Foundation of Islamic faith and practice</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-star-and-crescent"></i>
                </div>
                <h3 class="feature-title">Articles of Faith</h3>
                <p class="feature-desc">Core beliefs in Islam</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-history"></i>
                </div>
                <h3 class="feature-title">Islamic History</h3>
                <p class="feature-desc">Rich heritage and civilization</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-balance-scale"></i>
                </div>
                <h3 class="feature-title">Islamic Law</h3>
                <p class="feature-desc">Principles of Sharia and Fiqh</p>
            </div>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number">114</div>
                <div class="stat-label">Surahs in Quran</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">6,236</div>
                <div class="stat-label">Verses in Quran</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">5</div>
                <div class="stat-label">Daily Prayers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">99</div>
                <div class="stat-label">Names of Allah</div>
            </div>
        </div>

        <div class="knowledge-grid">
            <div class="knowledge-card">
                <div class="knowledge-icon">
                    <i class="fas fa-mosque"></i>
                </div>
                <h3 class="knowledge-title">Five Pillars of Islam</h3>
                <div class="knowledge-content">
                    <ul class="knowledge-list">
                        <li><i class="fas fa-check"></i> Shahada (Declaration of Faith)</li>
                        <li><i class="fas fa-check"></i> Salah (Five Daily Prayers)</li>
                        <li><i class="fas fa-check"></i> Zakat (Obligatory Charity)</li>
                        <li><i class="fas fa-check"></i> Sawm (Fasting in Ramadan)</li>
                        <li><i class="fas fa-check"></i> Hajj (Pilgrimage to Mecca)</li>
                    </ul>
                </div>
            </div>

            <div class="knowledge-card">
                <div class="knowledge-icon">
                    <i class="fas fa-star-and-crescent"></i>
                </div>
                <h3 class="knowledge-title">Articles of Faith</h3>
                <div class="knowledge-content">
                    <ul class="knowledge-list">
                        <li><i class="fas fa-check"></i> Belief in One God (Allah)</li>
                        <li><i class="fas fa-check"></i> Belief in Angels</li>
                        <li><i class="fas fa-check"></i> Belief in Divine Books</li>
                        <li><i class="fas fa-check"></i> Belief in Prophets</li>
                        <li><i class="fas fa-check"></i> Belief in Day of Judgment</li>
                        <li><i class="fas fa-check"></i> Belief in Divine Decree</li>
                    </ul>
                </div>
            </div>

            <div class="knowledge-card">
                <div class="knowledge-icon">
                    <i class="fas fa-history"></i>
                </div>
                <h3 class="knowledge-title">Islamic History</h3>
                <div class="knowledge-content">
                    <p>Explore the rich history of Islam from the time of Prophet Muhammad (PBUH) to the modern era. Learn about the Rashidun Caliphs, Islamic civilization's golden age, and contributions to science, mathematics, medicine, and philosophy that shaped the modern world.</p>
                </div>
            </div>

            <div class="knowledge-card">
                <div class="knowledge-icon">
                    <i class="fas fa-balance-scale"></i>
                </div>
                <h3 class="knowledge-title">Islamic Law & Ethics</h3>
                <div class="knowledge-content">
                    <p>Understand the principles of Sharia law, Islamic jurisprudence (Fiqh), and the ethical framework that guides Muslim life. Learn about halal and haram, business ethics, family law, social responsibilities, and the objectives of Islamic law (Maqasid al-Shariah).</p>
                </div>
            </div>
            
            <div class="knowledge-card">
                <div class="knowledge-icon">
                    <i class="fas fa-book"></i>
                </div>
                <h3 class="knowledge-title">99 Names of Allah</h3>
                <div class="knowledge-content">
                    <p>The 99 Names of Allah (Asma ul-Husna) are the beautiful names and attributes of God in Islam. Each name reflects a different aspect of Allah's perfection and majesty. Learning and reflecting on these names helps deepen one's understanding and connection with the Divine.</p>
                    <button class="control-btn" onclick="showSection('names-of-allah')" style="margin-top: 1rem; width: 100%;">
                        <i class="fas fa-star"></i> Explore the 99 Names
                    </button>
                </div>
            </div>
            
            <div class="knowledge-card">
                <div class="knowledge-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3 class="knowledge-title">Stories of the Prophets</h3>
                <div class="knowledge-content">
                    <p>The Quran contains numerous stories of prophets sent by Allah to guide humanity. These stories provide valuable lessons about faith, patience, perseverance, and submission to God's will. From Adam to Muhammad (peace be upon them all), each prophet's story carries profound wisdom.</p>
                    <button class="control-btn" onclick="showSection('prophet-stories')" style="margin-top: 1rem; width: 100%;">
                        <i class="fas fa-book-open"></i> Read Prophet Stories
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- User Dashboard Section -->
    <section id="dashboard" class="content-section">
        <div class="section-header">
            <h2>Your Dashboard</h2>
            <p>Track your progress and personalized content</p>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="dashboard-title">
                    <i class="fas fa-book-open"></i> Reading Progress
                </div>
                <div style="text-align: center; margin: 1.5rem 0;">
                    <svg width="120" height="120" viewBox="0 0 120 120" class="progress-ring">
                        <circle cx="60" cy="60" r="54" fill="transparent" stroke="#e2e8f0" stroke-width="8"></circle>
                        <circle cx="60" cy="60" r="54" fill="transparent" stroke="var(--primary)" stroke-width="8" stroke-dasharray="339.292" stroke-dashoffset="254.469" class="progress-ring-circle"></circle>
                        <text x="60" y="65" text-anchor="middle" fill="var(--primary)" font-size="16" font-weight="600">25%</text>
                    </svg>
                </div>
                <p style="text-align: center; color: var(--text-light);">You've completed 285 out of 1140 pages</p>
            </div>
            
            <div class="dashboard-card">
                <div class="dashboard-title">
                    <i class="fas fa-fire"></i> Current Streak
                </div>
                <div style="text-align: center; margin: 1.5rem 0;">
                    <div style="font-size: 3rem; color: #f59e0b;">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">7 days</div>
                </div>
                <p style="text-align: center; color: var(--text-light);">Keep going! You're on a roll.</p>
            </div>
            
            <div class="dashboard-card">
                <div class="dashboard-title">
                    <i class="fas fa-bookmark"></i> Bookmarks
                </div>
                <div style="margin: 1.5rem 0;">
                    <div class="knowledge-list">
                        <li><i class="fas fa-bookmark" style="color: var(--primary);"></i> Surah Al-Fatihah</li>
                        <li><i class="fas fa-bookmark" style="color: var(--primary);"></i> Surah Al-Baqarah: 255</li>
                        <li><i class="fas fa-bookmark" style="color: var(--primary);"></i> Surah Yaseen</li>
                        <li><i class="fas fa-bookmark" style="color: var(--primary);"></i> Surah Ar-Rahman</li>
                    </div>
                </div>
                <button class="control-btn" style="width: 100%;">
                    <i class="fas fa-eye"></i> View All Bookmarks
                </button>
            </div>
            
            <div class="dashboard-card">
                <div class="dashboard-title">
                    <i class="fas fa-sticky-note"></i> Personal Notes
                </div>
                <div style="margin: 1.5rem 0;">
                    <div class="knowledge-list">
                        <li><i class="fas fa-sticky-note" style="color: var(--primary);"></i> Reflection on Surah Al-Kahf</li>
                        <li><i class="fas fa-sticky-note" style="color: var(--primary);"></i> Questions about Zakat</li>
                        <li><i class="fas fa-sticky-note" style="color: var(--primary);"></i> Ramadan preparation list</li>
                    </div>
                </div>
                <button class="control-btn" style="width: 100%;">
                    <i class="fas fa-plus"></i> Add New Note
                </button>
            </div>
            
            <div class="dashboard-card">
                <div class="dashboard-title">
                    <i class="fas fa-trophy"></i> Achievements
                </div>
                <div style="margin: 1.5rem 0;">
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        <div style="background: var(--primary); color: white; padding: 0.5rem; border-radius: 8px; font-size: 0.8rem;">
                            <i class="fas fa-award"></i> First Reading
                        </div>
                        <div style="background: var(--primary); color: white; padding: 0.5rem; border-radius: 8px; font-size: 0.8rem;">
                            <i class="fas fa-award"></i> 7-Day Streak
                        </div>
                        <div style="background: #e2e8f0; color: var(--text-light); padding: 0.5rem; border-radius: 8px; font-size: 0.8rem;">
                            <i class="fas fa-award"></i> Quran Completer
                        </div>
                        <div style="background: #e2e8f0; color: var(--text-light); padding: 0.5rem; border-radius: 8px; font-size: 0.8rem;">
                            <i class="fas fa-award"></i> Hadith Scholar
                        </div>
                    </div>
                </div>
                <p style="text-align: center; color: var(--text-light); font-size: 0.9rem;">2 of 12 achievements unlocked</p>
            </div>
            
            <div class="dashboard-card">
                <div class="dashboard-title">
                    <i class="fas fa-bullseye"></i> Reading Goals
                </div>
                <div style="margin: 1.5rem 0;">
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Daily Goal</span>
                            <span>3/5 pages</span>
                        </div>
                        <div style="height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; background: var(--primary); width: 60%;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Weekly Goal</span>
                            <span>15/30 pages</span>
                        </div>
                        <div style="height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; background: var(--primary); width: 50%;"></div>
                        </div>
                    </div>
                </div>
                <button class="control-btn" style="width: 100%;">
                    <i class="fas fa-edit"></i> Edit Goals
                </button>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="content-section">
        <div class="section-header">
            <h2>About Quran Explorer</h2>
            <p>Your comprehensive Islamic resource</p>
        </div>

        <div class="feature-highlights">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-book"></i>
                </div>
                <h3 class="feature-title">Complete Quran</h3>
                <p class="feature-desc">Full text with translations</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-headphones"></i>
                </div>
                <h3 class="feature-title">Audio Recitations</h3>
                <p class="feature-desc">Multiple renowned reciters</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <h3 class="feature-title">Prayer Times</h3>
                <p class="feature-desc">Accurate location-based times</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-hands-praying"></i>
                </div>
                <h3 class="feature-title">Daily Duas</h3>
                <p class="feature-desc">Authentic supplications</p>
            </div>
        </div>

        <div class="knowledge-card" style="max-width: 800px; margin: 0 auto;">
            <h3 class="knowledge-title">Our Mission</h3>
            <div class="knowledge-content">
                <p>Quran Explorer is dedicated to providing authentic Islamic knowledge and resources to Muslims and anyone interested in learning about Islam. We strive to make the Quran and Islamic teachings accessible to everyone through modern technology.</p>
                
                <h4 style="margin-top: 1.5rem; color: var(--primary);">Features</h4>
                <ul class="knowledge-list">
                    <li><i class="fas fa-check"></i> Complete Quran with multiple translations</li>
                    <li><i class="fas fa-check"></i> Audio recitations by renowned reciters</li>
                    <li><i class="fas fa-check"></i> Tafsir (exegesis) for deeper understanding</li>
                    <li><i class="fas fa-check"></i> Accurate prayer times with location detection</li>
                    <li><i class="fas fa-check"></i> Daily Duas and supplications</li>
                    <li><i class="fas fa-check"></i> Hadith collection with translations</li>
                    <li><i class="fas fa-check"></i> Advanced audio playback controls</li>
                    <li><i class="fas fa-check"></i> Islamic knowledge and education</li>
                    <li><i class="fas fa-check"></i> User-friendly interface with dark mode</li>
                    <li><i class="fas fa-check"></i> <strong>NEW:</strong> User accounts and progress tracking</li>
                    <li><i class="fas fa-check"></i> <strong>NEW:</strong> Qibla finder with compass</li>
                    <li><i class="fas fa-check"></i> <strong>NEW:</strong> Islamic calendar with important dates</li>
                    <li><i class="fas fa-check"></i> <strong>NEW:</strong> Memorization mode for Quran revision</li>
                    <li><i class="fas fa-check"></i> <strong>NEW:</strong> Kids mode with simplified interface</li>
                    <li><i class="fas fa-check"></i> <strong>NEW:</strong> Word-by-word Quran analysis</li>
                </ul>

                <h4 style="margin-top: 1.5rem; color: var(--primary);">Data Sources</h4>
                <p>Our Quranic data is sourced from reliable APIs including AlQuran Cloud API. Prayer times are provided by Aladhan API. We verify all content to ensure authenticity and accuracy.</p>

                <h4 style="margin-top: 1.5rem; color: var(--primary);">Contact & Feedback</h4>
                <p>We welcome your feedback and suggestions to improve Quran Explorer. If you find any issues or have ideas for new features, please let us know.</p>
            </div>
        </div>
    </section>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h3>Settings</h3>
            <button class="control-btn" onclick="toggleSettings()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="settings-option">
            <label for="fontSize">Font Size</label>
            <select id="fontSize">
                <option value="small">Small</option>
                <option value="medium" selected>Medium</option>
                <option value="large">Large</option>
                <option value="x-large">X-Large</option>
            </select>
        </div>
        
        <div class="settings-option">
            <label for="arabicFont">Arabic Font</label>
            <select id="arabicFont">
                <option value="Noto Naskh Arabic" selected>Noto Naskh Arabic</option>
                <option value="Amiri">Amiri</option>
                <option value="Scheherazade">Scheherazade</option>
                <option value="Lateef">Lateef</option>
            </select>
        </div>
        
        <div class="settings-option">
            <label for="calculationMethod">Prayer Calculation</label>
            <select id="calculationMethod">
                <option value="1">Muslim World League</option>
                <option value="2">Islamic Society of North America</option>
                <option value="3">Egyptian General Authority</option>
                <option value="4">Umm Al-Qura University, Makkah</option>
                <option value="5">University of Islamic Sciences, Karachi</option>
                <option value="7">Institute of Geophysics, University of Tehran</option>
            </select>
        </div>
        
        <div class="settings-option">
            <label for="autoPlay">Auto Play Next Ayah</label>
            <select id="autoPlay">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>
        </div>
        
        <div class="settings-option">
            <label for="wordByWord">Word-by-Word Translation</label>
            <select id="wordByWord">
                <option value="true">Enable</option>
                <option value="false" selected>Disable</option>
            </select>
        </div>
        
        <div class="settings-option">
            <label for="notifications">Prayer Time Notifications</label>
            <select id="notifications">
                <option value="true">Enable</option>
                <option value="false" selected>Disable</option>
            </select>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Action completed successfully</span>
    </div>

    <div class="floating-icon" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- Word Tooltip -->
    <div class="word-tooltip" id="wordTooltip"></div>

    <div class="footer">
        <p>Quran Explorer • Complete Islamic Resource • Made with ❤️ for the Ummah</p>
        <p>© 2023 Quran Explorer Project • Data from AlQuran Cloud API & Aladhan API</p>
    </div>

    <script>
        // Global variables
        let allSurahs = [];
        let currentSurah = null;
        let currentReciter = 'ar.alafasy';
        let currentTranslation = 'en.asad';
        let prayerTimesData = null;
        let countdownInterval = null;
        let userLocation = null;
        let compassActive = false;
        let currentCalendarMonth = new Date().getMonth();
        let currentCalendarYear = new Date().getFullYear();
        let kidsMode = false;
        let repeatMode = false;
        let playbackSpeed = 1;
        let memorizationMode = false;
        let memorizationCurrentAyah = 0;
        let memorizationAyahs = [];
        let textVisible = true;
        
        // Audio player variables
        let currentAyahIndex = 0;
        let isPlaying = false;
        let autoPlayNext = false;

        // User data
        let currentUser = null;
        let userData = {
            readingProgress: 25,
            streak: 7,
            bookmarks: [
                { type: 'surah', id: 1, name: 'Surah Al-Fatihah' },
                { type: 'ayah', id: 255, surah: 2, name: 'Surah Al-Baqarah: 255' },
                { type: 'surah', id: 36, name: 'Surah Yaseen' },
                { type: 'surah', id: 55, name: 'Surah Ar-Rahman' }
            ],
            notes: [
                { title: 'Reflection on Surah Al-Kahf', content: 'Important lessons about faith and trials...' },
                { title: 'Questions about Zakat', content: 'Need to research more about zakat calculations...' },
                { title: 'Ramadan preparation list', content: 'Spiritual and physical preparation for Ramadan...' }
            ],
            achievements: ['first_reading', '7_day_streak']
        };

        // Dua data - Expanded with more authentic duas
        const duas = [
            {
                id: 1,
                title: "Dua for Entering the House",
                arabic: "بِسْمِ اللهِ وَلَجْنَا، وَبِسْمِ اللهِ خَرَجْنَا، وَعَلَى رَبِّنَا تَوَكَّلْنَا",
                translation: "In the name of Allah we enter, in the name of Allah we leave, and upon our Lord we rely",
                reference: "Abu Dawud 4/325",
                category: "Daily Duas"
            },
            {
                id: 2,
                title: "Dua for Leaving the House",
                arabic: "بِسْمِ اللهِ تَوَكَّلْتُ عَلَى اللهِ، لَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللهِ",
                translation: "In the name of Allah, I place my trust in Allah, and there is no might nor power except with Allah",
                reference: "Tirmidhi 3426",
                category: "Daily Duas"
            },
            {
                id: 3,
                title: "Dua for Entering the Mosque",
                arabic: "اللَّهُمَّ افْتَحْ لِي أَبْوَابَ رَحْمَتِكَ",
                translation: "O Allah, open for me the doors of Your mercy",
                reference: "Muslim 713",
                category: "Masjid Duas"
            },
            {
                id: 4,
                title: "Dua for Leaving the Mosque",
                arabic: "اللَّهُمَّ إِنِّي أَسْأَلُكَ مِنْ فَضْلِكَ",
                translation: "O Allah, I ask You from Your bounty",
                reference: "Muslim 713",
                category: "Masjid Duas"
            },
            {
                id: 5,
                title: "Dua for Traveling",
                arabic: "سُبْحَانَ الَّذِي سَخَّرَ لَنَا هَذَا وَمَا كُنَّا لَهُ مُقْرِنِينَ وَإِنَّا إِلَى رَبِّنَا لَمُنْقَلِبُونَ",
                translation: "Glory to Him who has brought this under our control, though we were unable to control it. Indeed, to our Lord we will return.",
                reference: "Quran 43:13-14",
                category: "Travel Duas"
            },
            {
                id: 6,
                title: "Dua for After Eating",
                arabic: "الْحَمْدُ لِلَّهِ الَّذِي أَطْعَمَنَا وَسَقَانَا وَجَعَلَنَا مُسْلِمِينَ",
                translation: "All praise is for Allah who fed us and gave us drink, and made us Muslims.",
                reference: "Tirmidhi 3457",
                category: "Food Duas"
            },
            {
                id: 7,
                title: "Dua for Seeking Knowledge",
                arabic: "اللَّهُمَّ انْفَعْنِي بِمَا عَلَّمْتَنِي، وَعَلِّمْنِي مَا يَنْفَعُنِي، وَزِدْنِي عِلْمًا",
                translation: "O Allah! Benefit me with what You have taught me, teach me what will benefit me, and increase me in knowledge.",
                reference: "Tirmidhi 3599",
                category: "Knowledge Duas"
            },
            {
                id: 8,
                title: "Dua for Forgiveness",
                arabic: "رَبِّ إِنِّي ظَلَمْتُ نَفْسِي فَاغْفِرْ لِي",
                translation: "My Lord, indeed I have wronged myself, so forgive me.",
                reference: "Quran 28:16",
                category: "Repentance Duas"
            },
            {
                id: 9,
                title: "Dua for Stress and Anxiety",
                arabic: "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْهَمِّ وَالْحَزَنِ، وَالْعَجْزِ وَالْكَسَلِ، وَالْبُخْلِ وَالْجُبْنِ، وَضَلَعِ الدَّيْنِ، وَغَلَبَةِ الرِّجَالِ",
                translation: "O Allah, I seek refuge in You from anxiety and sorrow, weakness and laziness, miserliness and cowardice, the burden of debts and from being overpowered by men.",
                reference: "Bukhari 6369",
                category: "Emotional Duas"
            },
            {
                id: 10,
                title: "Dua for Protection",
                arabic: "أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ",
                translation: "I seek refuge in the perfect words of Allah from the evil of what He has created.",
                reference: "Muslim 2708",
                category: "Protection Duas"
            },
            {
                id: 11,
                title: "Dua for Morning",
                arabic: "أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ",
                translation: "We have reached the morning and at this very time all sovereignty belongs to Allah. Praise is to Allah. There is no god but Allah, alone, without partner.",
                reference: "Muslim 2723",
                category: "Daily Duas"
            },
            {
                id: 12,
                title: "Dua for Evening",
                arabic: "أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ",
                translation: "We have reached the evening and at this very time all sovereignty belongs to Allah. Praise is to Allah. There is no god but Allah, alone, without partner.",
                reference: "Muslim 2723",
                category: "Daily Duas"
            },
            {
                id: 13,
                title: "Dua Before Sleeping",
                arabic: "بِاسْمِكَ اللَّهُمَّ أَمُوتُ وَأَحْيَا",
                translation: "In Your name, O Allah, I die and I live.",
                reference: "Bukhari 6324",
                category: "Sleep Duas"
            },
            {
                id: 14,
                title: "Dua Upon Waking Up",
                arabic: "الْحَمْدُ لِلَّهِ الَّذِي أَحْيَانَا بَعْدَ مَا أَمَاتَنَا وَإِلَيْهِ النُّشُورُ",
                translation: "All praise is for Allah who gave us life after having taken it from us and unto Him is the resurrection.",
                reference: "Bukhari 6312",
                category: "Sleep Duas"
            },
            {
                id: 15,
                title: "Dua for Seeking Goodness",
                arabic: "اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا",
                translation: "O Allah, I ask You for beneficial knowledge, goodly provision, and acceptable deeds.",
                reference: "Ibn Majah 925",
                category: "General Duas"
            }
        ];

        // Hadith data
        const hadiths = [
            {
                id: 1,
                title: "Hadith on Intentions",
                arabic: "إِنَّمَا الأَعْمَالُ بِالنِّيَّاتِ، وَإِنَّمَا لِكُلِّ امْرِئٍ مَا نَوَى",
                translation: "Actions are judged by intentions, and each person will be rewarded according to their intention.",
                reference: "Bukhari and Muslim",
                category: "Fundamentals"
            },
            {
                id: 2,
                title: "Hadith on Faith",
                arabic: "الإِسْلامُ أَنْ تَشْهَدَ أَنْ لا إِلَهَ إِلا اللَّهُ وَأَنَّ مُحَمَّدًا رَسُولُ اللَّهِ، وَتُقِيمَ الصَّلاةَ، وَتُؤْتِيَ الزَّكَاةَ، وَتَصُومَ رَمَضَانَ، وَتَحُجَّ الْبَيْتَ إِنِ اسْتَطَعْتَ إِلَيْهِ سَبِيلاً",
                translation: "Islam is to testify that there is no god but Allah and Muhammad is the Messenger of Allah, to establish prayer, to give charity, to fast in Ramadan, and to make pilgrimage to the House if you are able.",
                reference: "Muslim",
                category: "Fundamentals"
            },
            {
                id: 3,
                title: "Hadith on Brotherhood",
                arabic: "لا يُؤْمِنُ أَحَدُكُمْ حَتَّى يُحِبَّ لأَخِيهِ مَا يُحِبُّ لِنَفْسِهِ",
                translation: "None of you truly believes until he loves for his brother what he loves for himself.",
                reference: "Bukhari and Muslim",
                category: "Ethics"
            },
            {
                id: 4,
                title: "Hadith on Cleanliness",
                arabic: "الطُّهُورُ شَطْرُ الإِيمَانِ",
                translation: "Cleanliness is half of faith.",
                reference: "Muslim",
                category: "Purification"
            },
            {
                id: 5,
                title: "Hadith on Kindness",
                arabic: "الرَّاحِمُونَ يَرْحَمُهُمُ الرَّحْمَنُ، ارْحَمُوا مَنْ فِي الأَرْضِ يَرْحَمْكُمْ مَنْ فِي السَّمَاءِ",
                translation: "The merciful will be shown mercy by the Most Merciful. Be merciful to those on the earth and the One in the heavens will have mercy upon you.",
                reference: "Tirmidhi",
                category: "Ethics"
            },
            {
                id: 6,
                title: "Hadith on Knowledge",
                arabic: "مَنْ سَلَكَ طَرِيقًا يَلْتَمِسُ فِيهِ عِلْمًا سَهَّلَ اللَّهُ لَهُ بِهِ طَرِيقًا إِلَى الْجَنَّةِ",
                translation: "Whoever travels a path in search of knowledge, Allah will make easy for him a path to Paradise.",
                reference: "Muslim",
                category: "Knowledge"
            },
            {
                id: 7,
                title: "Hadith on Patience",
                arabic: "مَا يُصِيبُ الْمُسْلِمَ مِنْ نَصَبٍ وَلا وَصَبٍ وَلا هَمٍّ وَلا حُزْنٍ وَلا أَذًى وَلا غَمٍّ حَتَّى الشَّوْكَةِ يُشَاكُهَا إِلا كَفَّرَ اللَّهُ بِهَا مِنْ خَطَايَاهُ",
                translation: "No fatigue, nor disease, nor sorrow, nor sadness, nor hurt, nor distress befalls a Muslim, even if it were the prick he receives from a thorn, but that Allah expiates some of his sins for that.",
                reference: "Bukhari",
                category: "Patience"
            },
            {
                id: 8,
                title: "Hadith on Charity",
                arabic: "اتَّقُوا النَّارَ وَلَوْ بِشِقِّ تَمْرَةٍ",
                translation: "Protect yourselves from the Fire, even with half a date (in charity).",
                reference: "Bukhari",
                category: "Charity"
            },
            {
                id: 9,
                title: "Hadith on Good Character",
                arabic: "أَكْمَلُ الْمُؤْمِنِينَ إِيمَانًا أَحْسَنُهُمْ خُلُقًا",
                translation: "The most perfect of believers in faith are those with the best character.",
                reference: "Tirmidhi",
                category: "Ethics"
            },
            {
                id: 10,
                title: "Hadith on Prayer",
                arabic: "أَوَّلُ مَا يُحَاسَبُ بِهِ الْعَبْدُ يَوْمَ الْقِيَامَةِ الصَّلَاةُ، فَإِنْ صَلَحَتْ صَلَحَ سَائِرُ عَمَلِهِ، وَإِنْ فَسَدَتْ فَسَدَ سَائِرُ عَمَلِهِ",
                translation: "The first thing for which a person will be brought to account on the Day of Resurrection will be his prayer. If it is good, he will have succeeded, but if it is bad, he will have failed.",
                reference: "Tabarani",
                category: "Prayer"
            }
        ];

        // Group duas by category
        const duasByCategory = {};
        duas.forEach(dua => {
            if (!duasByCategory[dua.category]) {
                duasByCategory[dua.category] = [];
            }
            duasByCategory[dua.category].push(dua);
        });

        // Group hadiths by category
        const hadithsByCategory = {};
        hadiths.forEach(hadith => {
            if (!hadithsByCategory[hadith.category]) {
                hadithsByCategory[hadith.category] = [];
            }
            hadithsByCategory[hadith.category].push(hadith);
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadSurahs();
            loadDuas();
            loadHadiths();
            loadPrayerTimes();
            setupAudioPlayer();
            generateCalendar();
            loadImportantDates();
            
            // Set up event listeners
            document.getElementById('surahSearch').addEventListener('input', filterSurahs);
            document.getElementById('duaSearch').addEventListener('input', filterDuas);
            document.getElementById('hadithSearch').addEventListener('input', filterHadiths);
            document.getElementById('reciterSelector').addEventListener('change', function() {
                currentReciter = this.value;
            });
            document.getElementById('translationSelector').addEventListener('change', function() {
                currentTranslation = this.value;
                if (currentSurah) {
                    loadSurahDetail(currentSurah.number);
                }
            });

            // Load settings
            loadSettings();

            // Check for saved theme preference
            if (localStorage.getItem('quranExplorerDark') === 'true') {
                document.body.classList.add('dark');
            }
            
            // Check for kids mode
            if (localStorage.getItem('quranExplorerKidsMode') === 'true') {
                toggleKidsMode();
            }
            
            // Check for user login
            const savedUser = localStorage.getItem('quranExplorerUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUserInterface();
            }
        });

        // Section navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');

            // If prayer times section is shown, refresh prayer times
            if (sectionId === 'prayer-times') {
                refreshPrayerTimes();
            }
            
            // If qibla section is shown, start compass if not already active
            if (sectionId === 'qibla' && !compassActive) {
                startCompass();
            }
        }

        // Load and display surahs
        async function loadSurahs() {
            try {
                const response = await fetch('https://api.alquran.cloud/v1/surah');
                const data = await response.json();
                allSurahs = data.data;
                displaySurahs(allSurahs);
            } catch (error) {
                document.getElementById('surahGrid').innerHTML = `
                    <div class="knowledge-card" style="grid-column: 1 / -1; text-align: center;">
                        <h3>Error Loading Surahs</h3>
                        <p>Please check your internet connection and try again.</p>
                    </div>
                `;
            }
        }

        function displaySurahs(surahs) {
            const grid = document.getElementById('surahGrid');
            grid.innerHTML = '';
            
            surahs.forEach(surah => {
                const card = document.createElement('div');
                card.className = 'surah-card';
                card.innerHTML = `
                    <div class="surah-number">${surah.number}</div>
                    <h3 class="surah-name">${surah.englishName}</h3>
                    <div class="surah-name-arabic">${surah.name}</div>
                    <p>${surah.englishNameTranslation}</p>
                    <div class="surah-meta">
                        <span>${surah.revelationType}</span>
                        <span>${surah.numberOfAyahs} verses</span>
                    </div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button class="control-btn" onclick="loadSurahDetail(${surah.number})" style="padding: 0.5rem 1rem;">
                            <i class="fas fa-book-open"></i> Read
                        </button>
                        <button class="control-btn" onclick="startMemorizationForSurah(${surah.number})" style="padding: 0.5rem 1rem;">
                            <i class="fas fa-brain"></i> Memorize
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function filterSurahs() {
            const searchTerm = document.getElementById('surahSearch').value.toLowerCase();
            const filtered = allSurahs.filter(surah => 
                surah.englishName.toLowerCase().includes(searchTerm) ||
                surah.name.toLowerCase().includes(searchTerm) ||
                surah.englishNameTranslation.toLowerCase().includes(searchTerm)
            );
            displaySurahs(filtered);
        }

        // Load detailed surah view
        async function loadSurahDetail(surahNumber) {
            try {
                document.getElementById('surahGrid').style.display = 'none';
                document.getElementById('memorizationMode').style.display = 'none';
                const detailContainer = document.getElementById('surahDetail');
                detailContainer.style.display = 'block';
                detailContainer.innerHTML = '<div class="loading">Loading surah... <span class="loading-spinner"></span></div>';
                
                const [arabicResponse, translationResponse] = await Promise.all([
                    fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}`),
                    fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/${currentTranslation}`)
                ]);
                
                const arabicData = await arabicResponse.json();
                const translationData = await translationResponse.json();
                
                const surah = arabicData.data;
                currentSurah = surah;
                
                let html = `
                    <div class="section-header">
                        <h2>${surah.englishName} (${surah.name})</h2>
                        <p>${surah.englishNameTranslation} • ${surah.revelationType} • ${surah.numberOfAyahs} verses</p>
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-top: 1rem; flex-wrap: wrap;">
                            <button class="control-btn" onclick="backToSurahList()">
                                <i class="fas fa-arrow-left"></i> Back to Surah List
                            </button>
                            <button class="control-btn" onclick="startMemorizationForSurah(${surah.number})">
                                <i class="fas fa-brain"></i> Memorization Mode
                            </button>
                            <button class="control-btn" onclick="toggleWordByWord()" id="wordByWordBtn">
                                <i class="fas fa-language"></i> Word-by-Word
                            </button>
                        </div>
                    </div>
                `;
                
                for (let i = 0; i < surah.ayahs.length; i++) {
                    const ayah = surah.ayahs[i];
                    const translation = translationData.data.ayahs[i].text;
                    
                    html += `
                        <div class="ayah-card">
                            <div class="ayah-number">${ayah.numberInSurah}</div>
                            <div class="ayah" id="ayah-${i}">${ayah.text}</div>
                            <div class="translation">${translation}</div>
                            
                            <div class="audio-player-container">
                                <div class="player-controls">
                                    <button class="player-btn" onclick="playAyah(${i})">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <div class="player-info">
                                        <div class="player-surah">${surah.englishName}</div>
                                        <div class="player-ayah">Ayah ${ayah.numberInSurah}</div>
                                    </div>
                                    <button class="control-btn" onclick="bookmarkAyah(${surah.number}, ${ayah.numberInSurah})" style="padding: 0.5rem;">
                                        <i class="fas fa-bookmark"></i>
                                    </button>
                                </div>
                                <audio id="audio-${i}" preload="metadata">
                                    <source src="https://cdn.islamic.network/quran/audio/128/${currentReciter}/${ayah.number}.mp3">
                                </audio>
                            </div>
                            
                            <div class="tafsir-container">
                                <div class="tafsir-header" onclick="toggleTafsir(${ayah.number})">
                                    <span><i class="fas fa-book"></i> Tafsir (Exegesis)</span>
                                    <i class="fas fa-chevron-down tafsir-toggle" id="tafsir-toggle-${ayah.number}"></i>
                                </div>
                                <div class="tafsir-content" id="tafsir-content-${ayah.number}">
                                    <div class="loading">Loading tafsir... <span class="loading-spinner"></span></div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                detailContainer.innerHTML = html;
                
                // Load tafsir in background
                for (let i = 0; i < surah.ayahs.length; i++) {
                    loadTafsir(surah.ayahs[i].number);
                }
                
                // Setup word-by-word if enabled
                if (localStorage.getItem('quranExplorerWordByWord') === 'true') {
                    enableWordByWord();
                }
                
            } catch (error) {
                document.getElementById('surahDetail').innerHTML = `
                    <div class="knowledge-card" style="text-align: center;">
                        <h3>Error Loading Surah</h3>
                        <p>Please try again or select another surah.</p>
                        <button class="control-btn" onclick="backToSurahList()" style="margin-top: 1rem;">
                            <i class="fas fa-arrow-left"></i> Back to Surah List
                        </button>
                    </div>
                `;
            }
        }

        function backToSurahList() {
            document.getElementById('surahDetail').style.display = 'none';
            document.getElementById('memorizationMode').style.display = 'none';
            document.getElementById('surahGrid').style.display = 'grid';
            stopPlayback();
        }

        // Load tafsir for a specific ayah
        async function loadTafsir(ayahNumber) {
            try {
                const response = await fetch(`https://api.quran.com/api/v4/tafsirs?verse_key=${currentSurah.number}:${ayahNumber}&tafsir_id=169`);
                const data = await response.json();
                
                if (data.tafsirs && data.tafsirs.length > 0) {
                    const tafsirContent = document.getElementById(`tafsir-content-${ayahNumber}`);
                    if (tafsirContent) {
                        tafsirContent.innerHTML = `<p>${data.tafsirs[0].text}</p>`;
                    }
                } else {
                    throw new Error('Tafsir not available');
                }
            } catch (error) {
                const tafsirContent = document.getElementById(`tafsir-content-${ayahNumber}`);
                if (tafsirContent) {
                    tafsirContent.innerHTML = '<p>Tafsir not available for this verse.</p>';
                }
            }
        }

        // Toggle tafsir visibility
        function toggleTafsir(ayahNumber) {
            const content = document.getElementById(`tafsir-content-${ayahNumber}`);
            const toggleIcon = document.getElementById(`tafsir-toggle-${ayahNumber}`);
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                toggleIcon.classList.remove('expanded');
            } else {
                content.classList.add('expanded');
                toggleIcon.classList.add('expanded');
            }
        }

        // AUDIO PLAYER FUNCTIONS
        function setupAudioPlayer() {
            const audio = document.getElementById('globalAudio');
            const progressBar = document.getElementById('progressBar');
            const progress = document.getElementById('progress');
            const volumeSlider = document.getElementById('volumeSlider');
            
            // Update progress bar as audio plays
            audio.addEventListener('timeupdate', function() {
                if (audio.duration) {
                    const percent = (audio.currentTime / audio.duration) * 100;
                    progress.style.width = percent + '%';
                    
                    // Update time display
                    const currentTime = formatTime(audio.currentTime);
                    const duration = formatTime(audio.duration);
                    document.getElementById('timeDisplay').textContent = `${currentTime} / ${duration}`;
                }
            });
            
            // Handle audio ended event
            audio.addEventListener('ended', function() {
                if (repeatMode) {
                    audio.currentTime = 0;
                    audio.play();
                } else if (autoPlayNext && currentSurah && currentAyahIndex < currentSurah.ayahs.length - 1) {
                    playNextAyah();
                } else {
                    isPlaying = false;
                    updatePlayPauseButton();
                }
            });
            
            // Click on progress bar to seek
            progressBar.addEventListener('click', function(e) {
                const rect = progressBar.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                audio.currentTime = percent * audio.duration;
            });
            
            // Volume control
            volumeSlider.addEventListener('input', function() {
                audio.volume = this.value / 100;
            });
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        function playAyah(index) {
            if (!currentSurah) return;
            
            currentAyahIndex = index;
            const ayah = currentSurah.ayahs[index];
            const audio = document.getElementById('globalAudio');
            
            // Update player info
            document.getElementById('playerSurahName').textContent = `${currentSurah.englishName} - Ayah ${ayah.numberInSurah}`;
            document.getElementById('playerAyahInfo').textContent = `Ayah ${ayah.numberInSurah} of ${currentSurah.ayahs.length}`;
            
            // Set audio source
            audio.src = `https://cdn.islamic.network/quran/audio/128/${currentReciter}/${ayah.number}.mp3`;
            audio.playbackRate = playbackSpeed;
            
            // Show global player
            document.getElementById('globalPlayer').style.display = 'block';
            
            // Play audio
            audio.play();
            isPlaying = true;
            updatePlayPauseButton();
            
            // Scroll to the ayah being played
            const ayahElement = document.querySelector(`#audio-${index}`).closest('.ayah-card');
            if (ayahElement) {
                ayahElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        function togglePlayPause() {
            const audio = document.getElementById('globalAudio');
            
            if (isPlaying) {
                audio.pause();
                isPlaying = false;
            } else {
                audio.play();
                isPlaying = true;
            }
            
            updatePlayPauseButton();
        }
        
        function updatePlayPauseButton() {
            const button = document.getElementById('playPauseBtn');
            const icon = button.querySelector('i');
            
            if (isPlaying) {
                button.classList.add('pause');
                icon.className = 'fas fa-pause';
            } else {
                button.classList.remove('pause');
                icon.className = 'fas fa-play';
            }
        }
        
        function playNextAyah() {
            if (currentSurah && currentAyahIndex < currentSurah.ayahs.length - 1) {
                playAyah(currentAyahIndex + 1);
            }
        }
        
        function playPreviousAyah() {
            if (currentSurah && currentAyahIndex > 0) {
                playAyah(currentAyahIndex - 1);
            }
        }
        
        function stopPlayback() {
            const audio = document.getElementById('globalAudio');
            audio.pause();
            isPlaying = false;
            updatePlayPauseButton();
            document.getElementById('globalPlayer').style.display = 'none';
        }
        
        function toggleRepeatMode() {
            repeatMode = !repeatMode;
            const button = document.getElementById('repeatBtn');
            if (repeatMode) {
                button.style.background = 'var(--primary)';
                showToast('Repeat mode enabled', 'success');
            } else {
                button.style.background = '';
                showToast('Repeat mode disabled', 'success');
            }
        }
        
        function togglePlaybackSpeed() {
            const speeds = [0.5, 0.75, 1, 1.25, 1.5, 2];
            const currentIndex = speeds.indexOf(playbackSpeed);
            playbackSpeed = speeds[(currentIndex + 1) % speeds.length];
            
            const audio = document.getElementById('globalAudio');
            audio.playbackRate = playbackSpeed;
            
            const button = document.getElementById('speedBtn');
            button.textContent = `${playbackSpeed}x`;
            
            showToast(`Playback speed: ${playbackSpeed}x`, 'success');
        }

        // PRAYER TIMES IMPLEMENTATION
        async function loadPrayerTimes() {
            try {
                // Get user's location
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            userLocation = { lat, lng };
                            
                            // Get location name
                            const locationName = await getLocationName(lat, lng);
                            document.getElementById('locationInfo').innerHTML = `
                                <h3 style="margin-bottom: 0.5rem;">📍 ${locationName}</h3>
                                <p style="color: var(--text-light); font-size: 0.9rem;">
                                    Coordinates: ${lat.toFixed(4)}, ${lng.toFixed(4)} • 
                                    <button class="control-btn" onclick="refreshPrayerTimes()" style="padding: 0.3rem 0.8rem; font-size: 0.8rem;">
                                        <i class="fas fa-sync-alt"></i> Refresh
                                    </button>
                                </p>
                            `;
                            
                            // Load prayer times
                            await fetchPrayerTimes(lat, lng);
                        },
                        async () => {
                            // If location access is denied, use IP-based location
                            await getLocationByIP();
                        }
                    );
                } else {
                    // Geolocation not supported
                    await getLocationByIP();
                }
            } catch (error) {
                document.getElementById('locationInfo').innerHTML = `
                    <div style="text-align: center;">
                        <h3>Unable to detect location</h3>
                        <p>Please enable location access or check your connection.</p>
                        <button class="control-btn" onclick="loadPrayerTimes()" style="margin-top: 0.5rem;">
                            <i class="fas fa-sync-alt"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }

        async function getLocationByIP() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                userLocation = { lat: data.latitude, lng: data.longitude };
                
                document.getElementById('locationInfo').innerHTML = `
                    <h3 style="margin-bottom: 0.5rem;">📍 ${data.city}, ${data.country_name}</h3>
                    <p style="color: var(--text-light); font-size: 0.9rem;">
                        Detected by IP • 
                        <button class="control-btn" onclick="refreshPrayerTimes()" style="padding: 0.3rem 0.8rem; font-size: 0.8rem;">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </p>
                `;
                
                await fetchPrayerTimes(data.latitude, data.longitude);
            } catch (error) {
                document.getElementById('locationInfo').innerHTML = `
                    <div style="text-align: center;">
                        <h3>Location Detection Failed</h3>
                        <p>Please check your internet connection.</p>
                        <button class="control-btn" onclick="loadPrayerTimes()" style="margin-top: 0.5rem;">
                            <i class="fas fa-sync-alt"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }

        async function getLocationName(lat, lng) {
            try {
                const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lng}&localityLanguage=en`);
                const data = await response.json();
                return data.city ? `${data.city}, ${data.countryName}` : 'Your Location';
            } catch (error) {
                return 'Your Location';
            }
        }

        async function fetchPrayerTimes(latitude, longitude) {
            try {
                const method = document.getElementById('calculationMethod')?.value || '2'; // Default to ISNA
                const response = await fetch(`https://api.aladhan.com/v1/timings?latitude=${latitude}&longitude=${longitude}&method=${method}`);
                const data = await response.json();
                
                if (data.code === 200) {
                    prayerTimesData = data.data;
                    displayPrayerTimes();
                    startCountdown();
                } else {
                    throw new Error('Failed to fetch prayer times');
                }
            } catch (error) {
                document.getElementById('prayerTimesContainer').innerHTML = `
                    <div class="knowledge-card" style="grid-column: 1 / -1; text-align: center;">
                        <h3>Error Loading Prayer Times</h3>
                        <p>Please try again later.</p>
                        <button class="control-btn" onclick="refreshPrayerTimes()" style="margin-top: 1rem;">
                            <i class="fas fa-sync-alt"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }

        function displayPrayerTimes() {
            if (!prayerTimesData) return;
            
            const container = document.getElementById('prayerTimesContainer');
            const timings = prayerTimesData.timings;
            const date = prayerTimesData.date;
            
            const prayerTimes = [
                { name: 'Fajr', time: timings.Fajr, icon: 'fas fa-moon', class: 'fajr' },
                { name: 'Sunrise', time: timings.Sunrise, icon: 'fas fa-sun', class: 'sunrise' },
                { name: 'Dhuhr', time: timings.Dhuhr, icon: 'fas fa-sun', class: 'dhuhr' },
                { name: 'Asr', time: timings.Asr, icon: 'fas fa-cloud-sun', class: 'asr' },
                { name: 'Maghrib', time: timings.Maghrib, icon: 'fas fa-sun', class: 'maghrib' },
                { name: 'Isha', time: timings.Isha, icon: 'fas fa-moon', class: 'isha' }
            ];
            
            let html = '';
            prayerTimes.forEach(prayer => {
                const isCurrent = isCurrentPrayer(prayer.name, prayer.time);
                html += `
                    <div class="prayer-card ${prayer.class} ${isCurrent ? 'current' : ''}">
                        <div class="prayer-icon">
                            <i class="${prayer.icon}"></i>
                        </div>
                        <h3 class="prayer-name">${prayer.name}</h3>
                        <div class="prayer-time">${formatPrayerTime(prayer.time)}</div>
                        ${isCurrent ? '<div class="prayer-next">Next Prayer</div>' : ''}
                        ${isCurrent ? `<div class="countdown" id="countdown-${prayer.name}"></div>` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Update location info with date
            const locationElement = document.getElementById('locationInfo');
            const currentHtml = locationElement.innerHTML;
            locationElement.innerHTML = currentHtml.replace('</p>', ` • ${date.readable} | ${date.hijri.day} ${date.hijri.month.en} ${date.hijri.year}</p>`);
        }

        function isCurrentPrayer(prayerName, prayerTime) {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const prayerTimeMinutes = timeToMinutes(prayerTime);
            
            // For Fajr, it's current until Sunrise
            if (prayerName === 'Fajr') {
                const sunriseTime = timeToMinutes(prayerTimesData.timings.Sunrise);
                return currentTime >= prayerTimeMinutes && currentTime < sunriseTime;
            }
            
            // For other prayers, it's current until the next prayer
            const prayers = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            const currentIndex = prayers.indexOf(prayerName);
            const nextPrayer = prayers[currentIndex + 1];
            
            if (nextPrayer) {
                const nextPrayerTime = timeToMinutes(prayerTimesData.timings[nextPrayer]);
                return currentTime >= prayerTimeMinutes && currentTime < nextPrayerTime;
            }
            
            // Isha is current until next Fajr (next day)
            if (prayerName === 'Isha') {
                const nextFajr = timeToMinutes(prayerTimesData.timings.Fajr) + 24 * 60; // Next day
                return currentTime >= prayerTimeMinutes || currentTime < nextFajr - 24 * 60;
            }
            
            return false;
        }

        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function formatPrayerTime(timeStr) {
            const [hours, minutes] = timeStr.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const formattedHour = hour % 12 || 12;
            return `${formattedHour}:${minutes} ${ampm}`;
        }

        function startCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(() => {
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();
                
                const prayers = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
                let nextPrayer = null;
                let nextPrayerTime = null;
                
                // Find the next prayer
                for (const prayer of prayers) {
                    const prayerTime = timeToMinutes(prayerTimesData.timings[prayer]);
                    if (prayerTime > currentTime) {
                        nextPrayer = prayer;
                        nextPrayerTime = prayerTime;
                        break;
                    }
                }
                
                // If no prayer found today, use tomorrow's Fajr
                if (!nextPrayer) {
                    nextPrayer = 'Fajr';
                    nextPrayerTime = timeToMinutes(prayerTimesData.timings.Fajr) + 24 * 60;
                }
                
                // Calculate time difference
                const timeDiff = nextPrayerTime - currentTime;
                const hours = Math.floor(timeDiff / 60);
                const minutes = timeDiff % 60;
                
                // Update countdown displays
                document.querySelectorAll('.countdown').forEach(element => {
                    element.textContent = `${hours}h ${minutes}m until ${nextPrayer}`;
                });
                
                // Update current prayer highlighting
                document.querySelectorAll('.prayer-card').forEach(card => {
                    card.classList.remove('current');
                    const prayerName = card.querySelector('.prayer-name').textContent;
                    if (isCurrentPrayer(prayerName, prayerTimesData.timings[prayerName])) {
                        card.classList.add('current');
                    }
                });
                
            }, 1000);
        }

        function refreshPrayerTimes() {
            if (userLocation) {
                fetchPrayerTimes(userLocation.lat, userLocation.lng);
                showToast('Prayer times refreshed', 'success');
            } else {
                loadPrayerTimes();
            }
        }

        // QIBLA FINDER IMPLEMENTATION
        function startCompass() {
            if (!userLocation) {
                showToast('Please enable location services first', 'error');
                return;
            }
            
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                // iOS 13+ devices
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            initCompass();
                        } else {
                            showToast('Compass permission denied', 'error');
                        }
                    })
                    .catch(console.error);
            } else {
                // Non-iOS devices
                initCompass();
            }
        }
        
        function initCompass() {
            compassActive = true;
            window.addEventListener('deviceorientation', handleCompass);
            showToast('Compass activated. Point your device towards Mecca.', 'success');
        }
        
        function handleCompass(event) {
            if (!compassActive || !userLocation) return;
            
            // Calculate Qibla direction (simplified calculation)
            // In a real app, you would use more precise formulas
            const meccaLat = 21.4225;
            const meccaLng = 39.8262;
            
            const phiK = meccaLat * Math.PI / 180.0;
            const lambdaK = meccaLng * Math.PI / 180.0;
            const phi = userLocation.lat * Math.PI / 180.0;
            const lambda = userLocation.lng * Math.PI / 180.0;
            
            const qiblaDirection = Math.atan2(
                Math.sin(lambdaK - lambda),
                Math.cos(phi) * Math.tan(phiK) - Math.sin(phi) * Math.cos(lambdaK - lambda)
            ) * 180 / Math.PI;
            
            // Adjust for device orientation
            let direction = 0;
            if (event.alpha !== null) {
                direction = event.alpha; // Compass direction in degrees
            }
            
            // Calculate the angle to rotate the needle
            const needleAngle = (360 - direction + qiblaDirection + 360) % 360;
            
            // Update compass needle
            const needle = document.getElementById('compassNeedle');
            needle.style.transform = `translate(-50%, -50%) rotate(${needleAngle}deg)`;
            
            // Update direction text
            const directionElement = document.getElementById('qiblaDirection');
            directionElement.textContent = `Qibla Direction: ${Math.round(qiblaDirection)}°`;
        }

        // ISLAMIC CALENDAR IMPLEMENTATION
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const monthYearElement = document.getElementById('calendarMonthYear');
            
            // Get first day of month and number of days
            const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1).getDay();
            const daysInMonth = new Date(currentCalendarYear, currentCalendarMonth + 1, 0).getDate();
            
            // Month names
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Update month/year display
            monthYearElement.textContent = `${monthNames[currentCalendarMonth]} ${currentCalendarYear}`;
            
            // Clear previous calendar
            calendarGrid.innerHTML = '';
            
            // Add day headers
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayNames.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyElement = document.createElement('div');
                emptyElement.className = 'calendar-date';
                calendarGrid.appendChild(emptyElement);
            }
            
            // Add days of the month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateElement = document.createElement('div');
                dateElement.className = 'calendar-date';
                
                // Check if this is today
                if (day === today.getDate() && 
                    currentCalendarMonth === today.getMonth() && 
                    currentCalendarYear === today.getFullYear()) {
                    dateElement.classList.add('today');
                }
                
                dateElement.innerHTML = `
                    <div>${day}</div>
                    <div class="hijri-date">${getHijriDate(day, currentCalendarMonth, currentCalendarYear)}</div>
                `;
                
                calendarGrid.appendChild(dateElement);
            }
        }
        
        function changeCalendarMonth(direction) {
            currentCalendarMonth += direction;
            
            if (currentCalendarMonth > 11) {
                currentCalendarMonth = 0;
                currentCalendarYear++;
            } else if (currentCalendarMonth < 0) {
                currentCalendarMonth = 11;
                currentCalendarYear--;
            }
            
            generateCalendar();
            loadImportantDates();
        }
        
        function getHijriDate(day, month, year) {
            // Simplified conversion - in a real app, you would use a proper conversion algorithm
            // This is just a placeholder that shows approximate Hijri dates
            const hijriMonths = ['Muharram', 'Safar', 'Rabi al-Awwal', 'Rabi al-Thani', 
                'Jumada al-Awwal', 'Jumada al-Thani', 'Rajab', 'Sha\'ban', 
                'Ramadan', 'Shawwal', 'Dhu al-Qi\'dah', 'Dhu al-Hijjah'];
            
            // Very simplified conversion (not accurate)
            const hijriDay = day;
            const hijriMonthIndex = month;
            const hijriYear = year - 579; // Approximate difference
            
            return `${hijriDay} ${hijriMonths[hijriMonthIndex]}`;
        }
        
        function loadImportantDates() {
            const importantDatesElement = document.getElementById('importantDates');
            
            // Sample important dates - in a real app, you would fetch this data
            const importantDates = [
                { date: '1 Ramadan', event: 'Start of Ramadan' },
                { date: '27 Ramadan', event: 'Laylat al-Qadr' },
                { date: '1 Shawwal', event: 'Eid al-Fitr' },
                { date: '10 Dhu al-Hijjah', event: 'Eid al-Adha' },
                { date: '12 Rabi al-Awwal', event: 'Mawlid al-Nabi' }
            ];
            
            let html = '<ul class="knowledge-list">';
            importantDates.forEach(item => {
                html += `<li><i class="fas fa-star" style="color: var(--gold);"></i> <strong>${item.date}:</strong> ${item.event}</li>`;
            });
            html += '</ul>';
            
            importantDatesElement.innerHTML = html;
        }

        // MEMORIZATION MODE FUNCTIONS
        function startMemorizationForSurah(surahNumber) {
            if (!currentSurah || currentSurah.number !== surahNumber) {
                // Need to load the surah first
                loadSurahDetail(surahNumber).then(() => {
                    setTimeout(() => startMemorization(), 500);
                });
                return;
            }
            
            startMemorization();
        }
        
        function startMemorization() {
            if (!currentSurah) return;
            
            memorizationMode = true;
            memorizationCurrentAyah = 0;
            memorizationAyahs = currentSurah.ayahs;
            textVisible = true;
            
            document.getElementById('surahDetail').style.display = 'none';
            document.getElementById('surahGrid').style.display = 'none';
            document.getElementById('memorizationMode').style.display = 'block';
            
            updateMemorizationDisplay();
        }
        
        function updateMemorizationDisplay() {
            const textElement = document.getElementById('memorizationText');
            const progressElement = document.getElementById('memorizationProgress');
            const progressTextElement = document.getElementById('memorizationProgressText');
            
            if (memorizationCurrentAyah < memorizationAyahs.length) {
                const ayah = memorizationAyahs[memorizationCurrentAyah];
                textElement.textContent = ayah.text;
                textElement.className = `memorization-text ${textVisible ? '' : 'hidden'}`;
                
                const progress = ((memorizationCurrentAyah + 1) / memorizationAyahs.length) * 100;
                progressElement.style.width = `${progress}%`;
                progressTextElement.textContent = `${memorizationCurrentAyah + 1}/${memorizationAyahs.length}`;
            } else {
                textElement.textContent = 'Congratulations! You have completed memorizing this section.';
                textElement.className = 'memorization-text';
                progressElement.style.width = '100%';
                progressTextElement.textContent = 'Complete!';
            }
        }
        
        function toggleTextVisibility() {
            textVisible = !textVisible;
            updateMemorizationDisplay();
        }
        
        function nextAyahMemorization() {
            if (memorizationCurrentAyah < memorizationAyahs.length - 1) {
                memorizationCurrentAyah++;
                textVisible = true;
                updateMemorizationDisplay();
            }
        }
        
        function previousAyahMemorization() {
            if (memorizationCurrentAyah > 0) {
                memorizationCurrentAyah--;
                textVisible = true;
                updateMemorizationDisplay();
            }
        }
        
        function exitMemorizationMode() {
            memorizationMode = false;
            document.getElementById('memorizationMode').style.display = 'none';
            document.getElementById('surahDetail').style.display = 'block';
        }

        // WORD-BY-WORD FEATURE
        function toggleWordByWord() {
            const enabled = localStorage.getItem('quranExplorerWordByWord') === 'true';
            
            if (enabled) {
                disableWordByWord();
                localStorage.setItem('quranExplorerWordByWord', 'false');
                showToast('Word-by-word translation disabled', 'success');
            } else {
                enableWordByWord();
                localStorage.setItem('quranExplorerWordByWord', 'true');
                showToast('Word-by-word translation enabled', 'success');
            }
        }
        
        function enableWordByWord() {
            if (!currentSurah) return;
            
            // This is a simplified implementation
            // In a real app, you would fetch word-by-word data from an API
            const ayahElements = document.querySelectorAll('.ayah');
            
            ayahElements.forEach((ayahElement, index) => {
                const words = ayahElement.textContent.split(' ');
                let newHTML = '';
                
                words.forEach(word => {
                    newHTML += `<span class="word-highlight" data-word="${word}">${word} </span>`;
                });
                
                ayahElement.innerHTML = newHTML;
                
                // Add event listeners for word tooltips
                const wordElements = ayahElement.querySelectorAll('.word-highlight');
                wordElements.forEach(wordElement => {
                    wordElement.addEventListener('mouseenter', showWordTooltip);
                    wordElement.addEventListener('mouseleave', hideWordTooltip);
                });
            });
        }
        
        function disableWordByWord() {
            if (!currentSurah) return;
            
            const ayahElements = document.querySelectorAll('.ayah');
            
            ayahElements.forEach((ayahElement, index) => {
                ayahElement.textContent = currentSurah.ayahs[index].text;
            });
        }
        
        function showWordTooltip(event) {
            const word = event.target.getAttribute('data-word');
            const tooltip = document.getElementById('wordTooltip');
            
            // Simplified translation - in a real app, you would fetch this from an API
            const translations = {
                'بِسْمِ': 'In the name of',
                'اللَّهِ': 'Allah',
                'الرَّحْمَٰنِ': 'the Most Gracious',
                'الرَّحِيمِ': 'the Most Merciful'
                // Add more translations as needed
            };
            
            const translation = translations[word] || 'Translation not available';
            
            tooltip.innerHTML = `
                <div><strong>${word}</strong></div>
                <div>${translation}</div>
            `;
            
            tooltip.style.display = 'block';
            tooltip.style.left = `${event.pageX + 10}px`;
            tooltip.style.top = `${event.pageY + 10}px`;
        }
        
        function hideWordTooltip() {
            const tooltip = document.getElementById('wordTooltip');
            tooltip.style.display = 'none';
        }

        // KIDS MODE
        function toggleKidsMode() {
            kidsMode = !kidsMode;
            document.body.classList.toggle('kids-mode');
            
            if (kidsMode) {
                localStorage.setItem('quranExplorerKidsMode', 'true');
                showToast('Kids mode enabled', 'success');
            } else {
                localStorage.setItem('quranExplorerKidsMode', 'false');
                showToast('Kids mode disabled', 'success');
            }
        }

        // USER ACCOUNT FUNCTIONS
        function toggleUserPanel() {
            document.getElementById('userPanel').classList.toggle('open');
        }
        
        function showRegisterForm() {
            document.getElementById('userLoginForm').style.display = 'none';
            document.getElementById('userRegisterForm').style.display = 'block';
        }
        
        function showLoginForm() {
            document.getElementById('userRegisterForm').style.display = 'none';
            document.getElementById('userLoginForm').style.display = 'block';
        }
        
        function loginUser() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showToast('Please enter username and password', 'error');
                return;
            }
            
            // In a real app, you would verify credentials with a server
            // For this demo, we'll just create a user object
            currentUser = {
                username: username,
                email: `${username}@example.com`
            };
            
            localStorage.setItem('quranExplorerUser', JSON.stringify(currentUser));
            updateUserInterface();
            toggleUserPanel();
            showToast(`Welcome back, ${username}!`, 'success');
        }
        
        function registerUser() {
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            if (!username || !email || !password) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            // In a real app, you would send this data to a server
            currentUser = {
                username: username,
                email: email
            };
            
            localStorage.setItem('quranExplorerUser', JSON.stringify(currentUser));
            updateUserInterface();
            toggleUserPanel();
            showToast(`Account created for ${username}!`, 'success');
        }
        
        function logoutUser() {
            currentUser = null;
            localStorage.removeItem('quranExplorerUser');
            updateUserInterface();
            toggleUserPanel();
            showToast('You have been logged out', 'success');
        }
        
        function updateUserInterface() {
            const loginBtn = document.getElementById('userLoginBtn');
            const profileSection = document.getElementById('userProfile');
            const loginForm = document.getElementById('userLoginForm');
            
            if (currentUser) {
                loginBtn.innerHTML = '<i class="fas fa-user"></i> <span>Account</span>';
                profileSection.style.display = 'block';
                loginForm.style.display = 'none';
                
                document.getElementById('profileUsername').textContent = currentUser.username;
                document.getElementById('profileEmail').textContent = currentUser.email;
                
                // Update progress based on user data
                document.getElementById('readingProgressBar').style.width = `${userData.readingProgress}%`;
                document.getElementById('readingProgressText').textContent = `${userData.readingProgress}%`;
                document.getElementById('streakCount').textContent = `${userData.streak} days`;
            } else {
                loginBtn.innerHTML = '<i class="fas fa-user"></i> <span>Login</span>';
                profileSection.style.display = 'none';
                loginForm.style.display = 'block';
            }
        }
        
        function bookmarkAyah(surahNumber, ayahNumber) {
            if (!currentUser) {
                showToast('Please login to use bookmarks', 'error');
                return;
            }
            
            // Add to bookmarks
            const bookmark = {
                type: 'ayah',
                id: ayahNumber,
                surah: surahNumber,
                name: `Surah ${currentSurah.englishName}: ${ayahNumber}`
            };
            
            userData.bookmarks.push(bookmark);
            showToast('Ayah bookmarked', 'success');
        }

        // Load and display duas
        function loadDuas() {
            const container = document.getElementById('duasContainer');
            let html = '';
            
            for (const category in duasByCategory) {
                html += `<div class="dua-category">${category}</div>`;
                
                duasByCategory[category].forEach(dua => {
                    html += `
                        <div class="dua-card">
                            <div class="dua-title">
                                <i class="fas fa-bookmark"></i> ${dua.title}
                            </div>
                            <div class="dua-arabic">
                                ${dua.arabic}
                            </div>
                            <div class="dua-translation">
                                ${dua.translation}
                            </div>
                            <div class="dua-reference">
                                <i class="fas fa-book"></i> Reference: ${dua.reference}
                            </div>
                            <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                                <button class="control-btn" onclick="copyToClipboard('${dua.arabic.replace(/'/g, "\\'")}')" style="padding: 0.5rem 1rem;">
                                    <i class="fas fa-copy"></i> Copy Arabic
                                </button>
                                <button class="control-btn" onclick="copyToClipboard('${dua.translation.replace(/'/g, "\\'")}')" style="padding: 0.5rem 1rem;">
                                    <i class="fas fa-copy"></i> Copy Translation
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }

        function filterDuas() {
            const searchTerm = document.getElementById('duaSearch').value.toLowerCase();
            const allDuaCards = document.querySelectorAll('.dua-card');
            
            allDuaCards.forEach(card => {
                const title = card.querySelector('.dua-title').textContent.toLowerCase();
                const reference = card.querySelector('.dua-reference').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || reference.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Load and display hadiths
        function loadHadiths() {
            const container = document.getElementById('hadithsContainer');
            let html = '';
            
            for (const category in hadithsByCategory) {
                html += `<div class="hadith-category">${category}</div>`;
                
                hadithsByCategory[category].forEach(hadith => {
                    html += `
                        <div class="hadith-card">
                            <div class="hadith-title">
                                <i class="fas fa-quote-left"></i> ${hadith.title}
                            </div>
                            <div class="hadith-arabic">
                                ${hadith.arabic}
                            </div>
                            <div class="hadith-translation">
                                ${hadith.translation}
                            </div>
                            <div class="hadith-reference">
                                <i class="fas fa-book"></i> Reference: ${hadith.reference}
                            </div>
                            <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                                <button class="control-btn" onclick="copyToClipboard('${hadith.arabic.replace(/'/g, "\\'")}')" style="padding: 0.5rem 1rem;">
                                    <i class="fas fa-copy"></i> Copy Arabic
                                </button>
                                <button class="control-btn" onclick="copyToClipboard('${hadith.translation.replace(/'/g, "\\'")}')" style="padding: 0.5rem 1rem;">
                                    <i class="fas fa-copy"></i> Copy Translation
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }

        function filterHadiths() {
            const searchTerm = document.getElementById('hadithSearch').value.toLowerCase();
            const allHadithCards = document.querySelectorAll('.hadith-card');
            
            allHadithCards.forEach(card => {
                const title = card.querySelector('.hadith-title').textContent.toLowerCase();
                const reference = card.querySelector('.hadith-reference').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || reference.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Settings functions
        function toggleSettings() {
            document.getElementById('settingsPanel').classList.toggle('open');
        }

        function loadSettings() {
            const fontSize = localStorage.getItem('quranExplorerFontSize') || 'medium';
            const arabicFont = localStorage.getItem('quranExplorerArabicFont') || 'Noto Naskh Arabic';
            const calculationMethod = localStorage.getItem('quranExplorerCalculationMethod') || '2';
            autoPlayNext = localStorage.getItem('quranExplorerAutoPlay') === 'true';
            const wordByWord = localStorage.getItem('quranExplorerWordByWord') === 'true';
            
            document.getElementById('fontSize').value = fontSize;
            document.getElementById('arabicFont').value = arabicFont;
            document.getElementById('calculationMethod').value = calculationMethod;
            document.getElementById('autoPlay').value = autoPlayNext ? 'true' : 'false';
            document.getElementById('wordByWord').value = wordByWord ? 'true' : 'false';
            
            applyFontSize(fontSize);
            applyArabicFont(arabicFont);
        }

        function applyFontSize(size) {
            const sizes = {
                'small': '0.9rem',
                'medium': '1rem',
                'large': '1.1rem',
                'x-large': '1.2rem'
            };
            
            document.body.style.fontSize = sizes[size];
        }

        function applyArabicFont(font) {
            document.querySelectorAll('.ayah, .dua-arabic, .hadith-arabic, .surah-name-arabic').forEach(el => {
                el.style.fontFamily = font;
            });
        }

        // Utility functions
        function toggleNightMode() {
            const isDark = document.body.classList.toggle('dark');
            localStorage.setItem('quranExplorerDark', isDark);
            showToast(`Night mode ${isDark ? 'enabled' : 'disabled'}`, 'success');
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text)
                .then(() => {
                    showToast('Text copied to clipboard!', 'success');
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                    showToast('Failed to copy text', 'error');
                });
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Save settings when changed
        document.getElementById('fontSize').addEventListener('change', function() {
            localStorage.setItem('quranExplorerFontSize', this.value);
            applyFontSize(this.value);
        });

        document.getElementById('arabicFont').addEventListener('change', function() {
            localStorage.setItem('quranExplorerArabicFont', this.value);
            applyArabicFont(this.value);
        });

        document.getElementById('calculationMethod').addEventListener('change', function() {
            localStorage.setItem('quranExplorerCalculationMethod', this.value);
            if (userLocation) {
                fetchPrayerTimes(userLocation.lat, userLocation.lng);
                showToast('Prayer calculation method updated', 'success');
            }
        });

        document.getElementById('autoPlay').addEventListener('change', function() {
            autoPlayNext = this.value === 'true';
            localStorage.setItem('quranExplorerAutoPlay', autoPlayNext);
            showToast(`Auto-play ${autoPlayNext ? 'enabled' : 'disabled'}`, 'success');
        });

        document.getElementById('wordByWord').addEventListener('change', function() {
            localStorage.setItem('quranExplorerWordByWord', this.value);
            if (this.value === 'true' && currentSurah) {
                enableWordByWord();
            } else if (currentSurah) {
                disableWordByWord();
            }
            showToast(`Word-by-word ${this.value === 'true' ? 'enabled' : 'disabled'}`, 'success');
        });
    </script>
</body>
</html>
